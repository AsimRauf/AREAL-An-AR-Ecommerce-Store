version: 1
env:
  variables:
    NODE_ENV: production
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - npm install -D cross-env
        - npm install -D tailwindcss postcss-import postcss autoprefixer @tailwindcss/forms
    build:
      commands:
         - export AWS_ACCESS_KEY_ID="${AACCESS_KEY_ID}"
        - export AWS_SECRET_ACCESS_KEY="${SECRET_ACCESS_KEY}"
        - export AWS_REGION="${REGION}"
        - export AWS_BUCKET_NAME="${BUCKET_NAME}"
        - export MONGODB_PASSWORD="${MONGODB_PASSWORD}"
        - export JWT_SECRET="${JWT_SECRET}"
        - export NEXTAUTH_SECRET="${NEXTAUTH_SECRET}"
        - export NEXTAUTH_URL="${NEXTAUTH_URL}"
        - export CLOUDFRONT_KEY_PAIR_ID="${CLOUDFRONT_KEY_PAIR_ID}"
        - export CLOUDFRONT_PRIVATE_KEY="${CLOUDFRONT_PRIVATE_KEY}"
        - export CLOUDFRONT_URL="${CLOUDFRONT_URL}"
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
  customHeaders:
    - pattern: "/api/*"
      headers:
        - key: "Cache-Control"
          value: "no-store"
    - pattern: "/*"
      headers:
        - key: "Strict-Transport-Security"
          value: "max-age=31536000; includeSubDomains"
