version: 1
env:
  variables:
    NODE_ENV: production
frontend:
  phases:
    preBuild:
      commands:
        - echo "Node version: $(node -v)"
        - echo "NPM version: $(npm -v)"
        - rm -rf node_modules package-lock.json
        - npm cache clean --force
        - npm install
        - echo "Checking installed packages:"
        - npm list tailwindcss postcss-import @tailwindcss/forms
    build:
      commands:
        - echo "Starting build process..."
        - NODE_ENV=production npm run build
        - echo "Build completed"
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  customHeaders:
    - pattern: "/api/*"
      headers:
        - key: "Cache-Control"
          value: "no-store"
    - pattern: "/*"
      headers:
        - key: "Strict-Transport-Security"
          value: "max-age=31536000; includeSubDomains"
